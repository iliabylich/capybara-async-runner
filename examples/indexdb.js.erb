window.raiseHandler = function(err) {
  <%= fail_with_error(js[:err]) %>
}

window.plainSuccess = function(data) {
  <%= plain_success(js[:data]) %>
}

if (typeof(Dexie) === 'undefined') {
  raiseHandler('No Dexie')
}

var db = new Dexie('demo91');
db.version(1).stores({
  users: '++id,name'
});

db.open().catch(function(err) {
  fail_with_error('failed to open db' + err)
}).then(function() {
  db.users.add({
    name: 'Test Name',
  }).then(function(user_id) {
    console.log('user_id', user_id);
    db.users.where('id').equals(user_id).each(function(user) {
      plainSuccess(user);
    }).catch(function(err) {
      raiseHandler('where failed' + err)
    })
  }).catch(function(err) {
    raiseHandler('insert failed' + err)
  })
});
